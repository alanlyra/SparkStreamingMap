<!DOCTYPE html>
<meta charset="utf-8">

<html>
  <head>
    <meta charset="UTF-8">
  	<meta charset="UTF-8">
  	<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  	<meta http-equiv="X-UA-Compatible" content="ie=edge">
  	<link rel="stylesheet" href="css/normalize.css">
  	<link rel="stylesheet" href="css/style.css">
  	<title>Trabalho Big Data</title>
    <link href="./css/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">
    <link rel="stylesheet" href="./css/jquery-ui.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/5.0.0/normalize.min.css">
    <link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css'>
    <link rel="stylesheet" href="css/style-map.css">
    <script src="https://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>

  </head>

<body style="padding:0px;">
	<div class="site">
		<header class="l-cabecalho">
 				<div class="container">
				  <table width=100%> <tr class="menubar"> <td width=100% style="background-color:#1abc9c"> <table> <tr>
    		</div>
      </div></tr></table></td></tr></table></div>
		</header>
		<main>
			<header class="main-header">
			</header>

			<div class="container">
        <p>
          <input type="text" id="amount" readonly style="border:0; color:#06928a; font-weight:bold; text-align: center; font-size: 16px;">
        </p>
				<table>
  				<tr>
  				    <td width=470 valign=top>
          				<!-- Map Panel-->
                   <div id="map"></div>

                  <!-- <div id="csvdata"> -->
  				    </td>
  				</tr>
				</table>
			</div>
		</main>
		<footer class="l-footer">
      	<span class="versao-sistema">  </span>
        <img src="images/logo-fetranspor.png" alt="FETRANSPOR" class="logo-desfensoria" style="width:120px; height:"90px"">
        <img src="images/logo-coppe.png" alt="COPPE" class="logo-desfensoria" style="width:120px; height:"90px"">
    </footer>
	</div>
</body>

<script src="https://code.jquery.com/jquery-2.1.4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.2/papaparse.min.js"></script>

<script>

    var positions;

    $.ajax({
      type: "GET",
      url: "0.csv",
      dataType: "text",
      success: function(csv) {
      //toJSON function here
      csvJSON(csv);
      }
    });

    function csvJSON(csv){

      var lines=csv.split("\n");

      var result = [];

      var headers=lines[0].split(",");

      for(var i=1;i<lines.length;i++){

    	  var obj = {};
    	  var currentline=lines[i].split(",");

    	  for(var j=0;j<headers.length;j++){
    		  obj[headers[j]] = currentline[j];
    	  }

    	  result.push(obj);

        //console.log(obj);

      }

      //return result; //JavaScript object
      //console.log(JSON.stringify(result)); //JSON
      positions = result;
    }


</script>

<script>
  $(function(){
    $( "#amount" ).val( "Linha 5704A1" );
    // console.log(positions);
    var locations = [];
    for(chave in positions){
      console.log(positions[chave]["latitude"]);

      if(positions[chave]["codigo"] == "30536")
        locations.push(['<b>' + positions[chave]["linha"] + '</b><br>' + positions[chave]["codigo"], positions[chave]["latitude"], positions[chave]["longitude"], 2, "https://maps.google.com/mapfiles/ms/micons/bus.png"]);


      // locations = [
      // 	['<b>England Branch,</b><br> International city', -22.970722, -43.182365, 2, "https://maps.google.com/mapfiles/ms/micons/bus.png"],
      // 	['<b>Greec Branch,</b><br> International city', -22.990722, -43.182365, 1, "https://maps.google.com/mapfiles/ms/micons/bus.png"]
      // ];

    }
    var map = new google.maps.Map(document.getElementById('map'), {
    	zoom: 11,
    	center: new google.maps.LatLng(-22.970722, -43.182365), //Copacabana LatLong
    	mapTypeId: google.maps.MapTypeId.ROADMAP
    });
    var infowindow = new google.maps.InfoWindow();
    var marker, i;
    for (i = 0; i < locations.length; i++) {
    	marker = new google.maps.Marker({
    		position: new google.maps.LatLng(locations[i][1], locations[i][2]),
    		icon: locations[i][4],
    		map: map
    	});
    	google.maps.event.addListener(marker, 'click', (function (marker, i) {
    		return function () {
    			infowindow.setContent(locations[i][0]);
    			infowindow.open(map, marker);
    		}
    	})(marker, i));
    }
  });

</script>
